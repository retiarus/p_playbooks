---
- name: install terminal packages
  apt:
    name: "{{ item }}"
    state: present
  loop: "{{ terminal_p }}"
  ignore_errors: True

- name: set default shell to zsh
  user:
    name: peregrinus
    shell: /bin/zsh

- name: Create a 4096-bit SSH key for user peregrinus
  user:
    name: peregrinus
    generate_ssh_key: yes
    ssh_key_bits: 4096
    ssh_key_file: .ssh/id_rsa

- name: install pipenv, virtualenvwrapper
  pip:
    name: pipenv
    executable: pip3
    extra_args: --user
  with_items:
    - pipenv
    - virtualenvwrapper
  become: yes
  become_user: peregrinus
  ignore_errors: yes

- name: add user peregrinus to dialout
  user:
    name: peregrinus
    groups: dialout, users
    append: yes

- name: set primary group to peregrinus
  user:
    name: peregrinus
    group: peregrinus
    append: yes

- name: clone p_dotfiles
  git:
    repo: 'https://github.com/retiarus/p_dotfiles'
    dest: "{{ user_dotfiles | default('/home/peregrinus/p_dotfiles') }}"
    clone: yes
    update: yes
    recursive: yes
    force: yes
  become_user: peregrinus

- name: add hosts to host file
  lineinfile:
    path: "/etc/hosts"
    line: "{{ item }}"
  loop:
    - "192.168.5.11  ubuntu-server-01 ubuntu-server-01.falco.net"
    - "192.168.5.12  ubuntu-server-02 ubuntu-server-02.falco.net"
    - "192.169.5.13  ubuntu-server-03 ubuntu-server-03.falco.net"
    - "192.168.5.3   falco03          falco03.falco.net"
    - "192.168.5.254 openwrt          openwrt.falco.net"
    - "192.168.5.1   pfsense          pfsense.falco.net"
    - "192.168.5.250 pi-router        pi-router.falco.net"
    - "192.168.5.253 blacknas         blacknas.falco.net"
...
